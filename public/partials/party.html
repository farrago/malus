<!-- Refreshing progress bar -->
<div class="row" ng-show="!currentUser || !party">
  <div class="col-md-12">
    <h1>Refreshing <small><i class="icon-spinner icon-spin"></i></small></h1>
  </div>
</div>
<div ng-show="currentUser && party">
  <div class="page-header">
    <h2><span contenteditable="{{editable}}" ng-model="party.name" on-ok="party.ui.edit=true"></span>

      <!-- Edit button -->
      <span class="pull-right" ng-hide="outstandingReads">
        <button class="btn" ng-click="allowEdit()" ng-hide="editable"><i class="icon-edit muted" tooltip="Enable Editing"></i></button>
        <button class="btn" ng-click="refreshAll()" ng-hide="editable"><i class="icon-refresh muted" tooltip="Refresh"></i></button>
        <button class="btn btn-primary" ng-click="endEdit()" ng-show="editable"><span tooltip="Save Changes"><i class="icon-cloud-upload"></i>&nbsp;Save</span></button>
        <button class="btn" ng-click="cancelEdit()" ng-show="editable">Cancel</button>
      </span>
      <span class="pull-right" ng-show="outstandingReads">
        <i class="icon-spinner icon-spin"></i>
      </span>
      <small>
        <span ng-hide="party.notes">Notes:</span>
        <span contenteditable="{{editable}}" on-ok="party.ui.edit=true" ng-model="party.notes"></span>
      </small>
    </h2>
  </div>

  <tabs>
    <!-- ============================================================================== -->
    <!-- Characters tab                                                                 -->
    <!-- ============================================================================== -->
    <pane heading="Characters" icon="group">
      <div class="row">
        <div class="col-md-12 table-responsive">
          <table class="table table-condensed text-center">
            <td ng-repeat="pc in party.pc_chars">
              <a href ng-click="selection.char = pc" class="btn" ng-class="{'btn-primary':pc.id == selection.char.id}">
                {{pc.name | shortname}}<br/>
                <span class="badge"><i class="icon-heart"></i> {{pc.tmpStats['e']}} / {{pc.stats['eUp']}}</span>
              </a>
            </td>
            <td ng-repeat="npc in party.npc_chars | orderBy:npcsortid:true" >
              <a  href ng-click="selection.char = npc" class="btn" ng-class="{'btn-primary':npc.id == selection.char.id}">
                {{npc.name | shortname}}<br/>
                <span class="badge"><i class="icon-heart"></i> {{npc.tmpStats['e']}} / {{npc.stats['eUp']}}</span>
              </a>
            </td>
          </table>
        </div>
      </div>
      
      <!-- Modify Party members -->
      <div ng-show="editable" class="form-horizontal">
        <fieldset>
          <legend>Modify party members</legend>
          <select ng-model="selectedChar" ng-options="c.id as c.name for c in availableChars" class="input-large" placeholder="Select character"></select>
          <button class="btn btn-primary" ng-click="addPC(selectedChar)"><i class="icon-plus"></i>&nbsp;Add as PC</button>
          <button class="btn btn-primary" ng-click="addNPC(selectedChar)"><i class="icon-plus"></i>&nbsp;Add as NPC</button>
        </fieldset>
      </div>

      <div ng-controller="CharacterCtrl" ng-init="initFromData(selection.char,'pc')">
        <ng-include src="'/partials/sub/party_character.html'"></ng-include>
      </div>

      <form ng-show="editable">
        <fieldset>
          <legend>Add New NPC to the party</legend>
          <label for="newnpcname">Name</label>
          <input type="text" placeholder="New NPC Name" ng-model="newNPC.name" id="newnpcname">
          <label for="newnpcendurance">Endurance</label>
          <input type="number" placeholder="Endurance" ng-model="newNPC.eUP" id="newnpcendurance" />
          <span class="help-block">Initial Endurance for this new NPC (Defaults to 0 if left blank)</span>
          <button type="submit" class="btn btn-primary" ng-click="addNewNPC()"><i class="icon-plus"></i> Add New NPC</button>
        </fieldset>
      </form>

    </pane>

    <!-- ============================================================================== -->
    <!-- Settings tab  (always make it last)                                            -->
    <!-- ============================================================================== -->
    <pane heading="Settings" icon="cog">
      <!-- Users List -->
      <div ng-show="editable" class="form-horizontal">
        <fieldset>
          <legend>Modify users</legend>
          <select ng-model="selectedUser" ng-options="u.id as u.username for u in availableUsers" class="input-large"></select>
          <button class="btn btn-primary" ng-click="addUser(selectedUser)"><i class="icon-plus"></i>&nbsp;Add</button>
          <button class="btn btn-primary" ng-click="removeUser(selectedUser)"><i class="icon-trash"></i>&nbsp;Remove</button>
        </fieldset>
      </div>

      <h1>Players</h1>
      <div ng-repeat="player in players">
        {{player.username}}
      </div>
    </pane>
 
  </tabs>
</div>
